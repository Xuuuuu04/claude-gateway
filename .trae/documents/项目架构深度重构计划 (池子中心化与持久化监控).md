## 项目架构重构：池子中心化与持久化监控

### 1. 数据库模型重构 (Migration)
- **新增 `0003_restructure.sql`**:
  - `pools` 表：新增 `client_key` (唯一索引)，`credential_ids_json` (存储绑定的上游凭据 ID 列表)，`model_map_json` (池子级模型映射)。
  - `request_logs` 表：结构化字段优化（pool_id, provider_id, credential_id, client_key, status, latency 等）。
  - **数据平滑迁移**: 自动将旧的 `pools -> channels -> credentials` 关系转换为新的 `pools -> credentials`。
  - **清理**: 删除废弃的 `channels` 和 `routing_rules` 表。

### 2. 核心路由引擎升级 ([router.go](file:///Users/xushaoyang/Desktop/Claude负载与反代/internal/router/router.go))
- **Key 绑定路由**: 建立 `ClientKey -> Pool` 的高速索引。
- **极简选路逻辑**:
  1. 根据请求 Header 的 API Key 直接锁定 `Pool`。
  2. 在 `Pool` 内部根据策略直接挑选 `Credential`。
  3. 自动合并供应商级和池子级的模型映射规则。

### 3. 持久化监控与日志系统 ([logbus.go](file:///Users/xushaoyang/Desktop/Claude负载与反代/internal/logbus/bus.go))
- **异步落库**: 修改 `LogBus`，实现实时 SSE 传输的同时，将请求元数据结构化存入 `request_logs` 表。
- **持久化面板**: 为管理台提供历史日志查询接口。

### 4. 管理台 UI 深度重构 ([index.html](file:///Users/xushaoyang/Desktop/Claude负载与反代/internal/admin/web/index.html))
- **以“池子”为核心的配置流**:
  - 创建池子即分配 Client Key。
  - 详情页直接勾选所属供应商的 Key，无需中转。
- **实时监控大屏**:
  - 结构化表格展示实时请求。
  - 支持按状态、池子、模型进行持久化数据检索。

### 5. 验证与交付
- **编译与回归测试**: 确保重构后逻辑严密。
- **重启服务**: 在 `:8091` 端口启动，验证全流程。

**任务立即开始执行。**